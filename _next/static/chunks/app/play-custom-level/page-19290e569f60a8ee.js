(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{1203:(e,t,s)=>{"use strict";s.d(t,{A:()=>r});var a=s(5155),n=s(2115);function r(e){let{timeLeft:t,totalTime:s}=e,[r,i]=(0,n.useState)("text-white");(0,n.useEffect)(()=>{t<=.2*s?i("text-red-500 animate-pulse"):t<=.5*s?i("text-orange-400"):i("text-white")},[t,s]);let l=Math.floor(t/60),c=t%60;return(0,a.jsx)("div",{className:"text-2xl font-bold ".concat(r," bg-gray-800 bg-opacity-80 px-4 py-2 rounded-lg"),children:l>0?"".concat(l,":").concat(c.toString().padStart(2,"0")):"".concat(c,"秒")})}},4409:(e,t,s)=>{"use strict";s.d(t,{A:()=>i});var a=s(5155),n=s(2115),r=s(5585);function i(){let[e,t]=(0,n.useState)(null);return(0,n.useEffect)(()=>{let e=document.createElement("canvas");e.className="fixed inset-0 w-full h-full pointer-events-none z-50",document.body.appendChild(e),t(e);let s=r.A.create(e,{resize:!0,useWorker:!0}),a=Date.now()+5e3,n=setInterval(()=>{if(Date.now()>a){clearInterval(n);return}s({particleCount:100,spread:70,origin:{y:.6},colors:["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff"]})},400);return setTimeout(()=>{s({particleCount:100,angle:60,spread:55,origin:{x:0}}),s({particleCount:100,angle:120,spread:55,origin:{x:1}})},200),setTimeout(()=>{s({particleCount:150,spread:100,origin:{y:.5},gravity:.5,scalar:1.2,drift:0})},600),()=>{e&&e.parentNode&&e.parentNode.removeChild(e),clearInterval(n)}},[]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)("div",{className:"stars-container",children:Array.from({length:20}).map((e,t)=>(0,a.jsx)("div",{className:"star",style:{left:"".concat(100*Math.random(),"%"),top:"".concat(100*Math.random(),"%"),animationDelay:"".concat(2*Math.random(),"s"),animationDuration:"".concat(1+2*Math.random(),"s")}},t))})})}},5600:(e,t,s)=>{Promise.resolve().then(s.bind(s,8787))},8787:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>k});var a=s(5155),n=s(2115),r=s(5707),i=s(7558),l=s(1421),c=s(4932),o=s(7168),u=s(88),d=s(2714),m=s(3842),x=s(4409),h=s(1203),f=s(5339),v=s(6516),g=s(9026),b=s(3291),p=s(6332);function y(e){let{customLevel:t,onBack:s}=e,[r,y]=(0,n.useState)(!1),[j,w]=(0,n.useState)(!1),[N,k]=(0,n.useState)(!1),[S,L]=(0,n.useState)(t.timeLimit||0),[P,C]=(0,n.useState)(!1),[E,A]=(0,n.useState)(!0),[M,z]=(0,n.useState)(!1),[T,I]=(0,n.useState)(!1),[D,_]=(0,n.useState)(!1),R=(0,n.useRef)(null),$=(0,n.useRef)({x:0,y:0}),q=(0,n.useRef)(null),K=(0,n.useRef)(null),B=(0,n.useRef)(null),F=(()=>{let e=t.lines.map(e=>new b.tG(new b.ag(e.start.x,e.start.y),new b.ag(e.end.x,e.end.y),e.friction,e.bounce,e.color));return{id:t.id,lines:e,ball:new b.qr("custom_ball",new b.ag(t.startPosition.x,t.startPosition.y),new b.ag(0,0),.5,"#ff8888"),startPosition:new b.ag(t.startPosition.x,t.startPosition.y),endPosition:new b.ag(t.endPosition.x,t.endPosition.y),gravity:new b.ag(0,-9.81),timeLimit:t.timeLimit||0,applyPhysics:()=>{},checkCollisions:()=>{},isSolved:()=>!1,reset:()=>{},render:()=>{}}})();(0,n.useEffect)(()=>{L(t.timeLimit||0),C(!1)},[t]);let G=()=>{B.current&&clearInterval(B.current),B.current=setInterval(()=>{L(e=>e<=1?(H(),0):e-1)},1e3)},O=()=>{B.current&&(clearInterval(B.current),B.current=null)},H=()=>{O(),C(!0),y(!1)};(0,n.useEffect)(()=>{if(!E)return;let e=e=>{if(!r||!R.current)return;let t=e.accelerationIncludingGravity;if(!t||null===t.x||null===t.y)return;let s=-(.3*t.x),a=.3*t.y;R.current.applyImpulse({x:s,y:a,z:0},!0),(Math.abs(s)>1||Math.abs(a)>1)&&(I(!0),q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{I(!1)},500))},t=async()=>{if("undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission)try{let t=await DeviceMotionEvent.requestPermission();"granted"===t?window.addEventListener("devicemotion",e):z(!0)}catch(e){console.error("Error requesting device motion permission:",e),z(!0)}else window.addEventListener("devicemotion",e)},s=e=>{if(!r||!R.current)return;let t={x:e.clientX,y:e.clientY},s=t.x-$.current.x,a=t.y-$.current.y;$.current=t,(Math.abs(s)>15||Math.abs(a)>15)&&(R.current.applyImpulse({x:.05*s,y:-(.05*a),z:0},!0),I(!0),q.current&&clearTimeout(q.current),q.current=setTimeout(()=>{I(!1)},500))};return E&&(t(),window.addEventListener("mousemove",s)),()=>{window.removeEventListener("devicemotion",e),window.removeEventListener("mousemove",s),q.current&&clearTimeout(q.current),K.current&&clearTimeout(K.current),B.current&&clearInterval(B.current)}},[E,r]);let J=t.lines.some(e=>Math.abs(e.start.x)>10||Math.abs(e.start.y)>6||Math.abs(e.end.x)>10||Math.abs(e.end.y)>6);return(0,a.jsxs)("div",{className:"relative w-full h-full",children:[M&&(0,a.jsxs)(g.Fc,{className:"absolute top-4 left-4 right-4 z-10 bg-amber-100 border-amber-300",children:[(0,a.jsx)(f.A,{className:"h-4 w-4 text-amber-600"}),(0,a.jsx)(g.TN,{children:"デバイスの動きへのアクセスが許可されていません。設定から許可してください。"})]}),(0,a.jsxs)("div",{className:"absolute top-4 left-4 z-10 flex items-center space-x-2",children:[(0,a.jsx)(o.$,{variant:"outline",onClick:s,className:"bg-gray-800 text-white hover:bg-gray-700",children:"← 戻る"}),(0,a.jsxs)(o.$,{variant:"outline",className:"bg-gray-800 text-white hover:bg-gray-700",onClick:()=>_(!D),children:[(0,a.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"シェア"]})]}),D&&(0,a.jsxs)("div",{className:"absolute top-16 left-4 z-10 bg-gray-800 p-4 rounded-lg shadow-lg",children:[(0,a.jsx)("h3",{className:"text-white text-sm mb-2",children:"レベルをシェア"}),(0,a.jsx)(p.A,{title:j?"「".concat(t.name,"」をクリアしました！ - Kuso Physics"):"「".concat(t.name,"」に挑戦しよう！ - Kuso Physics"),description:j?"作者: ".concat(t.author||"匿名"," のレベル「").concat(t.name,"」をクリアしました！あなたも挑戦してみませんか？"):"作者: ".concat(t.author||"匿名"," のレベル「").concat(t.name,"」に挑戦しよう！物理パズルゲーム Kuso Physics"),hashtags:["KusoPhysics","物理パズル","カスタムレベル"]}),(0,a.jsx)("button",{className:"absolute top-2 right-2 text-gray-400 hover:text-white",onClick:()=>_(!1),children:"✕"})]}),(0,a.jsx)("div",{className:"w-full h-full ".concat(T?"animate-shake":""),children:(0,a.jsxs)(i.Hl,{shadows:!0,camera:{position:J?[0,0,20]:[0,0,15],fov:50},children:[(0,a.jsx)("ambientLight",{intensity:.5}),(0,a.jsx)("directionalLight",{position:[10,10,10],intensity:1,castShadow:!0}),(0,a.jsx)(l.AQ,{gravity:[0,-9.81,0],children:(0,a.jsx)(m.A,{puzzle:F,isSimulating:r,onPuzzleSolved:()=>{w(!0),y(!1),k(!0),O(),K.current&&clearTimeout(K.current),K.current=setTimeout(()=>{k(!1),_(!0)},5e3)},setBallRef:e=>{R.current=e},isSolved:j})}),(0,a.jsx)(c.N,{enableZoom:!0,enablePan:!0})]})}),t.timeLimit>0&&(0,a.jsx)("div",{className:"absolute top-16 left-1/2 transform -translate-x-1/2",children:(0,a.jsx)(h.A,{timeLeft:S,totalTime:t.timeLimit})}),N&&(0,a.jsx)("div",{className:"absolute inset-0 pointer-events-none",children:(0,a.jsx)(x.A,{})}),(0,a.jsxs)("div",{className:"absolute top-4 right-4 flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"bg-gray-800 p-2 rounded text-white",children:[(0,a.jsx)("h3",{className:"font-bold",children:t.name}),(0,a.jsxs)("p",{className:"text-sm",children:["作者: ",t.author||"匿名"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-800 p-2 rounded",children:[(0,a.jsx)(u.d,{id:"shake-mode",checked:E,onCheckedChange:A}),(0,a.jsx)(d.J,{htmlFor:"shake-mode",className:"text-white",children:"シェイクモード"})]})]}),j&&(0,a.jsxs)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-70 p-6 rounded-xl text-center animate-bounce-in",children:[(0,a.jsx)("h2",{className:"text-4xl font-bold text-white mb-2",children:"クリア！"}),(0,a.jsx)("p",{className:"text-xl text-green-400",children:"おめでとうございます！"}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsxs)(o.$,{onClick:()=>_(!0),className:"bg-blue-600 hover:bg-blue-500 text-white",children:[(0,a.jsx)(v.A,{className:"h-4 w-4 mr-2"}),"クリアをシェア"]})})]}),P&&(0,a.jsxs)("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-black bg-opacity-70 p-6 rounded-xl text-center animate-bounce-in",children:[(0,a.jsx)("h2",{className:"text-4xl font-bold text-red-500 mb-2",children:"タイムアップ！"}),(0,a.jsx)("p",{className:"text-xl text-white",children:"もう一度挑戦しましょう"})]}),(0,a.jsx)("div",{className:"absolute bottom-4 left-4 right-4 flex justify-center",children:r?(0,a.jsx)(o.$,{onClick:()=>{y(!1),w(!1),k(!1),C(!1),O(),L(t.timeLimit||0)},className:"bg-red-600 hover:bg-red-500",children:"リセット"}):(0,a.jsx)(o.$,{onClick:()=>{y(!0),w(!1),k(!1),C(!1),t.timeLimit>0&&(L(t.timeLimit),G())},className:"bg-green-600 hover:bg-green-500",children:"スタート"})})]})}var j=s(7746),w=s(5325),N=s(1639);function k(){let[e,t]=(0,n.useState)(null);return(0,a.jsxs)("main",{className:"flex min-h-screen flex-col bg-gray-900",children:[(0,a.jsx)(w.A,{}),(0,a.jsx)("div",{className:"absolute top-4 right-4 z-10",children:(0,a.jsx)(N.A,{})}),e?(0,a.jsx)("div",{className:"flex-1 w-full",children:(0,a.jsx)(y,{customLevel:e,onBack:()=>t(null)})}):(0,a.jsx)("div",{className:"flex-1 container mx-auto py-8",children:(0,a.jsx)(r.A,{onSelectLevel:t,showPlayButton:!0})}),!e&&(0,a.jsx)(j.A,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[932,831,367,413,180,175,212,585,79,803,707,441,684,358],()=>t(5600)),_N_E=e.O()}]);